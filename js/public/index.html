<!-- -*- indent-tabs-mode: nil; tab-width: 2; -*- -->
<!-- vim: set ts=2 sw=2 et ai : -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>WebSocket tests</title>
  </head>
  <body>
    <script type="module">
      import "./noble-ed25519.js";
      import "./es-first-aid.js";
      console.log(nobleEd25519);
      const ed = nobleEd25519;

      globalThis.ws = new WebSocket(`wss://${location.host}/ws`);

      (async () => {
        //
        const privateKey = ed.utils.randomPrivateKey();
        const publicKey = await ed.getPublicKey(privateKey);
        const message = {
          type: "register",
        };
        const json = JSON.stringify(message);
        const data = firstAid.encodeString(json);
        const signature = await ed.sign(data, privateKey);
        const signedMessage = {
          type: 'signed_envelope',
          algo: 'sign-ed25519',
          data: firstAid.encodeBase64(data),
          public_key: firstAid.encodeBase64(publicKey),
          signature: firstAid.encodeBase64(signature),
        };
        const registerMsg = JSON.stringify(signedMessage);
        console.log(registerMsg);
        ws.send(registerMsg);
      })();
    </script>
  </body>
</html>